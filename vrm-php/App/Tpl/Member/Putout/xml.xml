<?xml version="1.0" encoding="UTF-8"?>

<krpano showerrors="false" onstart="action(start);action(fixfov);"  idletime="{$panorow['autonextpass']}">
    <php>echo "<include";</php> url="%SWFPATH%/base.xml" />
	<php>echo "<include";</php> url="%SWFPATH%/plugins/showtext.xml" />
    <if condition="$panorow['is_ipad_view'] eq 1">
        <plugin name="skin_gyro" keep="true" url="%SWFPATH%/plugins/gyro.js" devices="html5+!firefox" enabled="true" camroll="true" friction="0" velastic="0" onavailable="if(device.fullscreensupport, if(device.mobile,add(layer[skin_btn_gyro].x,40),add(layer[skin_btn_gyro].x,20));); set(layer[skin_btn_gyro].visible,true);" />
    </if>

    <action name="start">
        loadscene(scene{$firstscene['sort']}, null, MERGE);
        <if condition="$panorow['open_music'] eq 1">
        playsound(bgsnd, '%SWFPATH%/music/{$musicurl||basename=###}', 0);
        </if>
		if(autorotate.enabled == true ,bombtimer(0););
		<if condition="$panorow['opennews'] eq 'true'">danmurun1();</if>
    </action>

	<plugin name="soundinterface"
        url="%SWFPATH%/plugins/soundinterface.swf"
        alturl="%SWFPATH%/plugins/soundinterface.js"
	rootpath="" preload="true" keep="true" loops="1" />

    <eq name="strorow['open']" value="1">
        <layer name="introimage" url="%SWFPATH%/toolbox/intro/{$strorow['image']|basename=###}" enabled="true" align="center" onclick="hideintroimage();" keep="true" visible="true" zorder="50000"/>

        <action name="hideintroimage">
            if(layer[introimage].enabled,
                    set(layer[introimage].enabled,false);
                    tween(layer[introimage].alpha, 0.0, 0.5, default, removelayer(introimage));
              );
        </action>
    </eq>

    <if condition="$panorow['open_music'] eq 1 AND $panorow['open_musicbtn'] eq 1">
        <plugin name="musicbtn" url="%SWFPATH%/music/{$panorow['musicpic']||basename=###}"
             onurl="%SWFPATH%/music/{$panorow['musicpic']||basename=###}"
             offurl="%SWFPATH%/music/{$panorow['musichoverpic']||basename=###}"
             onalpha="{$panorow['alpha']}" outalpha="{$panorow['hoveralpha']}" keep="true"
             align="{$panorow['musicposto']}" x="{$panorow['mpos_x']}" y="{$panorow['mpos_y']}" alpha="{$panorow['alpha']}" scale="1" onover="tween(alpha,get(onalpha));" onout="tween(alpha,get(outalpha));"
			onclick="pausesoundtoggle(bgsnd); switch(url, get(onurl), get(offurl));"
            />
		<krpano devices="mobile">				
			<plugin name="musicbtn" scale="0.5" altscale="0.5" />
		</krpano>
    </if>

    <if condition="$panorow['openautorate'] eq 1">
    <autorotate enabled="true" waittime="{$panorow['autoratewaittime']}" speed="{$panorow['autoratespeed']}" accel="1" horizon="0" tofov="100" />
    <else/>
    <autorotate enabled="false" />
    </if>

    <volist name="sysuirow" id="sui">
        <php>echo "<include";</php> url="%SWFPATH%/ui/{$sui.path}/skin/skin.xml" />
    </volist>
	<php>echo "<include";</php> url="%SWFPATH%/krpanocms.xml?<php>echo time();</php>" />
	<php>echo "<include";</php> url="%SWFPATH%/gundongzimu.xml?<php>echo time();</php>" />
	<php>echo "<include";</php> url="%SWFPATH%/cms_config.xml?<php>echo time();</php>" />
	<php>echo "<include";</php> url="%SWFPATH%/html.xml?<php>echo time();</php>" />
	<if condition="$panorow['openwechat'] eq 1">
	<php>echo "<include";</php> url="%SWFPATH%/shuoyishuo.xml?<php>echo time();</php>" />
	<php>echo "<include";</php> url="%SWFPATH%/hotspotComment.xml?<php>echo time();</php>" />
	</if>
	<php>echo "<include";</php> url="%SWFPATH%/video-player.xml?<php>echo time();</php>" />

<events onclick="screentosphere(mouse.x,mouse.y,h,v);trace(h);" />
<events onxmlcomplete="set(control.mousetype, moveto);" />
<skin_settings openautonext="{$panorow['openautonext']}" thumbs_width="{$panorow['thumbwidth']}" thumbs_height="{$panorow['thumbheight']}" thumbs_padding="10" thumbs_crop="" krpanocms="true" domainlink="{$domainlink}" groupid="1" webvr="true" bgmusic="false" bgyunyin="false" erweima="{$panorow['openshare']}" opennews="{$panorow['opennews']}" news="{$panorow['gundongzimu']}" opentel="{$panorow['opentel']}" tel="openurl('tel://{$panorow['linkphone']}',_blank)" openhttp="{$panorow['openhttp']}" http="openurl('{$panorow['website']}',_blank )" opendaohang="{$panorow['opendaohang']}" daohang="openurl('http://apis.map.qq.com/uri/v1/geocoder?coord={$panorow[map]}',_blank )" opencard="{$panorow['opencard']}" ope_bdmap="" bd_map="" openzan="{$panorow['openzan']}" pano_id="{$pano_id}"></skin_settings>
<lensflareset name="DEFAULT" url="%SWFPATH%/lensflare/flares.jpg"/>

<if condition="!empty($panorow['openpanologo'])&&!empty($panorow['pano_logo'])">
<layer name="ui_logo" type="images" url="%SWFPATH%/images/uiimage/{$panorow['pano_logo']||basename=###}" keep="true" visible="true" zorder="0" align="lefttop" x="2" y="55" autowidth="" autoheight="" scale="1.0" altscale="1.0" alpha="1" />
</if>

<if condition="!empty($panorow['openauthor'])&&!empty($userinfo['company_logo'])">
<layer name="zj-logo" type="images" url="%SWFPATH%/images/uiimage/{$userinfo['company_logo']||basename=###}" keep="true" visible="true" zorder="0" align="rightbottom" x="80" y="30" autowidth="" autoheight="" scale="1.0" altscale="1.0" alpha="1"
<if condition="!empty($userinfo[company_url])">onclick="openurl('{$userinfo[company_url]}',_blank);"</if> />
</if>

<if condition="!empty($panorow['openwelcome'])&&!empty($panorow['welcome'])">
<layer name="welcome" type="image" visible="true" url="%SWFPATH%/images/uiimage/{$panorow['welcome']||basename=###}" keep="true" scale="0.5" alpha="1" width="998" height="666" x="0" y="0"  align="center" zorder="100"  maskchildren="false" onclick="action(welcome_close,welcome);" onloaded="welcome_close_ready();" />
<action name="welcome_close">
	tween(plugin[%1].alpha,0,0.5,default, set(plugin[%1].visible,false));
</action>
<action name="welcome_close_ready">
delayedcall(10,welcome_close(welcome));
</action>
</if>

<if condition="$panorow['opentongji'] eq 1">
<style name="cms_view" url="%SWFPATH%/plugins/textfield.swf" zorder="0" align="lefttop" x="20" oy="30" keep="true" backgroundcolor="0xFFFFFF" backgroundalpha="0.0" roundedge="0" css="font-family:黑体; font-size:16px; color:#FFFFFF;"  width="300" autoheight="" />
<layer name="cms_view_html" style="cms_view" html=""/>
<action name="cms_view_html">
set(layer[cms_view_html].html,%1);
</action>
</if>


<if condition="!empty($navList)">
<style name="nav_text" url="%SWFPATH%/plugins/textfield.swf" zorder="0" align="center" keep="true" backgroundcolor="0xFFFFFF" backgroundalpha="0.0" roundedge="0" css="font-family:Arial,宋体;font-size:14px;font-weight:bold;color:{$panonav.color};" width="100" height="28" autoheight="" />
<krpano devices="desktop">
<volist name="navList" id="nav">
<layer name="nav_{$nav.id}" keep="true" url="{$nav.navbg_file}" x="{$nav.navbg_x}" y="0" crop="0|{$nav.navbg_crop}|{$nav.navbg_width}|{$nav.navbg_crop}" onovercrop="0|{$nav.navbg_height}|{$nav.navbg_width}|{$nav.navbg_crop}" align="righttop" visible="true"/>
<layer name="nav_{$nav.id}_html" style="nav_text" parent="nav_{$nav.id}" ox="{$panonav.ox}" oy="{$panonav.oy}" html="{$nav.navname}" onover="set(layer[nav_{$nav.id}_html].css,'font-family:Arial,宋体;font-size:14px;font-weight:bold;color:{$panonav.overcolor};');" 
onout="set(layer[nav_{$nav.id}_html].css,'font-family:Arial,宋体;font-size:14px;font-weight:bold;color:{$panonav.color};');" 
<if condition="$nav['opentype'] eq 1 or $nav['opentype'] eq 3">onclick="openIframe({$panonav.iframewidth},{$panonav.iframeheight},'{$nav.linkurl}')"</if>
<if condition="$nav['opentype'] eq 2">onclick="openLink('{$nav.linkurl}')"</if>
/>
</volist>
</krpano>
</if>

<layer name="Iframe_close" keep="true" url="/Public/pano/images/fx.png" align="righttop" edge="righttop" width="25" height="25" x="8" y="8" onclick="closeIframe()" zorder="1" visible="false" />
<action name="Iframe_bg">
if(layer[openIframe_bg],'',
	<!-- step one - add a background layer and fade it in -->
	set(layer[Iframe_close].visible, true);
	addlayer(openIframe_bg);
	set(layer[openIframe_bg].type, container);
	set(layer[openIframe_bg].zindex, 999999);
	set(layer[openIframe_bg].align, lefttop);
	set(layer[openIframe_bg].width, 100%);
	set(layer[openIframe_bg].height, 100%);
	set(layer[openIframe_bg].bgcolor, 0x000000);
	set(layer[openIframe_bg].bgalpha, 0.5);
	set(layer[openIframe_bg].bgcapture, true);
	set(layer[openIframe_bg].handcursor, false);
	set(layer[openIframe_bg].alpha, 0.0);
	set(layer[openIframe_bg].onclick, closeIframe());	
	tween(layer[openIframe_bg].alpha, 1.0, 0.5, default);
);
</action>
<action name="openIframe">
Iframe_bg();
js(openIframe(%1,%2,%3,1));
</action>

<krpano devices="mobile">
<action name="openIframe">
txtadd(openurl,%3,'/m_type/1');
openwindow(get(openurl),100%,100%);
</action>
</krpano>

<action name="openLink">
js(openLink(%1));
</action>
<action name="closeIframe">
set(layer[openIframe_bg].onclick, null);
js(closeIframe());
tween(layer[openIframe_bg].alpha, 0.0, 0.5, default,
	removelayer(openIframe_bg);
	set(layer[Iframe_close].visible, false);
);
</action>


<krpano devices="mobile">
<layer name="zj-logo" x="10" y="45" scale="0.5" altscale="0.5"/>
<layer name="ui_logo" y="50" scale="0.5" altscale="0.5" />
<layer name="welcome" scale="0.2" altscale="0.2"/>
<style name="cms_view" x="10" css="font-family:黑体; font-size:12px; color:#FFFFFF;" />
</krpano>



    <volist name="uirow" id="ui">
        <php>echo "<include";</php> url="%SWFPATH%/ui/ui{$ui.uid}/ui.xml?<php>echo time();</php>" />
    </volist>

    <volist name="mbuirow" id="mbui">
        <php>echo "<include";</php> url="%SWFPATH%/ui/ui{$mbui.uid}/mbui.xml?<php>echo time();</php>" />
    </volist>

	<if condition="!empty($banrow)">
     <contextmenu>
         <volist name="banrow" id="ban">
             <switch name="ban['type']">
                <case value="none">
                    <item name="ban{$ban.id}" caption="{$ban.title}" onclick=""/>
                </case>
                <case value="link">
                    <item name="ban{$ban.id}" caption="{$ban.title}" onclick="linkto({$ban.link})"/>
                </case>
                <default /><item name="ban{$ban.id}" caption="{$ban.title}" onclick="{$ban.type}()"/>
                </switch>
         </volist>
    </contextmenu>
	</if> 

    <eq name="toolboxmap_on" value="1">
        <php>echo "<include";</php> url="%SWFPATH%/toolbox/map/map.xml?<php>echo time();</php>" />
    </eq>

    <eq name="toolboxmaps_on" value="1">
        <php>echo "<include";</php> url="%SWFPATH%/toolbox/maps/map.xml?<php>echo time();</php>" />
    </eq>

    <volist name="viewlist" id="view">
		<if condition="$view['sort'] eq $firstscene['sort'] and $panorow['is_littleplanet_view'] eq 1">
        	<scene name="scene{$view['sort']}" title="{$view['title']}" thumburl="%SWFPATH%/scene/scene{$view.sort}/{$view['thumb']||basename=###}" onstart="newsceneevent();" firsttime="true">
		<else/>
		<scene name="scene{$view['sort']}" title="{$view['title']}" thumburl="%SWFPATH%/scene/scene{$view.sort}/{$view['thumb']||basename=###}" onstart="newsceneevent();">
		</if>
            <events name="viewevent" />
            <eq name="view['open_limit']" value="0">
                <view hlookat="{$view['hlookat']}" vlookat="{$view['vlookat']}" fov="{$view['fov']}" fisheye="0" fovmin="{$view['fovmin']}" fovmax="{$view['fovmax']}" />
            </eq>
            <eq name="view['open_limit']" value="1">
                <view hlookat="{$view['hlookat']}" vlookat="{$view['vlookat']}" fov="{$view['fov']}" fisheye="0" fovmin="{$view['fovmin']}" fovmax="{$view['fovmax']}"
                    limitview="{$view['limitview']}" hlookatmin="{$view['hlookatmin']}" hlookatmax="{$view['hlookatmax']}" vlookatmin="{$view['vlookatmin']}" vlookatmax="{$view['vlookatmax']}"
                />
            </eq>

            <eq name="view['vopen']" value="0">
                <preview url="%SWFPATH%/scene/scene{$view.sort}/view/preview.jpg" />
                <image type="CUBE">
                    <cube url="%SWFPATH%/scene/scene{$view.sort}/view/{$view['pano_path']||basename=###}" />
                </image>
            </eq>
            <eq name="view['vopen']" value="1">
                <preview url="%SWFPATH%/scene/scene{$view.sort}/scene/preview.jpg" />
                <image type="CUBE" multires="true" tilesize="256" progressive="false">
                    <level tiledimagewidth="{$view['v1']}" tiledimageheight="{$view['v1']}">
                        <cube url="%SWFPATH%/scene/scene{$view.sort}/scene/pian_%s/l2/%v/l2_%s_%v_%h.jpg" />
                    </level>
                    <level tiledimagewidth="{$view['v2']}" tiledimageheight="{$view['v2']}">
                        <cube url="%SWFPATH%/scene/scene{$view.sort}/scene/pian_%s/l1/%v/l1_%s_%v_%h.jpg" />
                    </level>
                    <mobile>
                        <cube url="%SWFPATH%/scene/scene{$view.sort}/scene/pano_%s.jpg" />
                    </mobile>
				</image>
            </eq>

            <if condition="$view['openmusic'] eq 1">
            <events name="sound{$view['sort']}" onnewpano="playsound(bgsnd{$view['sort']}, '%SWFPATH%/scene/scene{$view.sort}/{$view['musicfile']||basename=###}', {$view['musictimes']});set(sound[bgsnd{$view['sort']}].volume,{$view['musicvolume']});"  onremovepano="stopsound(bgsnd{$view['sort']});" />
            </if>

            <eq name="view['logo']['open']" value="1">
                <hotspot name="nadirlogo"
                     url="%SWFPATH%/toolbox/bottomlogo/{$view['logo']['image']|basename=###}"
                     ath="0"
                     atv="90"
                     distorted="true"
                     scale="{$view['logo']['scale']/100}"
                     rotate="0.0"
                     />
            </eq>
				
            <volist name="view['roam']" id="roam">
                <if condition="$roam['spot_type'] eq 1">
                    <hotspot style="skin_hotspotstyle" title="{$roam['title']}" devices="{$device[$roam['is_flash']][$roam['is_html5']]}" name="spot{$roam.id}" alpha="1" ath="{$roam.spot_x}" scale="{$roam['spot_scale']/100}"
                    atv="{$roam.spot_y}" url="%SWFPATH%/spot/{$spotdata[$roam['spot_id']]['file']||basename=###}"
                    align="{$roam.spot_edge}" edge="{$roam.spot_edge}" zorder="2"
					<eq name="roam['is_showtext']" value="1">onloaded="showtxt_action();"</eq>
				            
                    <switch name="roam.changetype" >
                        <case value="1">onclick="ifnot(device.html5,moveto({$roam['spot_x']},{$roam['spot_y']},smooth());loadscene(scene{$scenedata[$roam['target_id']]}, view.vlookat={$roam['target_y']}&amp;view.hlookat={$roam['target_x']}, MERGE,ZOOMBLEND(1,3));,loadscene(scene{$scenedata[$roam['target_id']]}, view.hlookat={$roam['target_x']}, MERGE,ZOOMBLEND(1,3)););"</case>
                        <case value="2">onclick="ifnot(device.html5,moveto({$roam['spot_x']},{$roam['spot_y']},smooth());loadscene(scene{$scenedata[$roam['target_id']]}, view.vlookat={$roam['target_y']}&amp;view.hlookat={$roam['target_x']}, MERGE,BLEND(1));,loadscene(scene{$scenedata[$roam['target_id']]}, view.hlookat={$roam['target_x']}, MERGE,BLEND(1)););"</case>
                        <case value="3">onclick="ifnot(device.html5,loadscene(scene{$scenedata[$roam['target_id']]}, view.vlookat={$roam['target_y']}&amp;view.hlookat={$roam['target_x']}, MERGE,BLEND(1));,loadscene(scene{$scenedata[$roam['target_id']]}, view.hlookat={$roam['target_x']}, MERGE,BLEND(1)););"</case>
                        <default />
                    </switch>
                    />
                    <elseif condition="$roam['spot_type'] eq 2"/>
                    <hotspot style="skin_hotspotstyle" title="{$roam['title']}" devices="{$device[$roam['is_flash']][$roam['is_html5']]}" name="spot{$roam.id}" alpha="1" ath="{$roam.spot_x}" scale="{$roam['spot_scale']/100}" atv="{$roam.spot_y}" url="%SWFPATH%/spot/{$spotdata[$roam['spot_id']]['file']||basename=###}"
                    align="{$roam.spot_edge}" edge="{$roam.spot_edge}" zorder="2" 
                    <if condition="$roam['is_showtext'] eq 1">
					onloaded="do_crop_animation({$spotdata[$roam['spot_id']]['width']},{$spotdata[$roam['spot_id']]['height']},60);showtxt_action();"
					<else/>
					onloaded="do_crop_animation({$spotdata[$roam['spot_id']]['width']},{$spotdata[$roam['spot_id']]['height']},60);"
					</if>
                    <switch name="roam.changetype" >
                        <case value="1">onclick="ifnot(device.html5,moveto({$roam['spot_x']},{$roam['spot_y']},smooth());loadscene(scene{$scenedata[$roam['target_id']]}, view.vlookat={$roam['target_y']}&amp;view.hlookat={$roam['target_x']}, MERGE,ZOOMBLEND(1,3));,loadscene(scene{$scenedata[$roam['target_id']]}, view.hlookat={$roam['target_x']}, MERGE,ZOOMBLEND(1,3)););"</case>
                        <case value="2">onclick="ifnot(device.html5,moveto({$roam['spot_x']},{$roam['spot_y']},smooth());loadscene(scene{$scenedata[$roam['target_id']]}, view.vlookat={$roam['target_y']}&amp;view.hlookat={$roam['target_x']}, MERGE,BLEND(1));,loadscene(scene{$scenedata[$roam['target_id']]}, view.hlookat={$roam['target_x']}, MERGE,BLEND(1)););"</case>
                        <case value="3">onclick="ifnot(device.html5,loadscene(scene{$scenedata[$roam['target_id']]}, view.vlookat={$roam['target_y']}&amp;view.hlookat={$roam['target_x']}, MERGE,BLEND(1));,loadscene(scene{$scenedata[$roam['target_id']]}, view.hlookat={$roam['target_x']}, MERGE,BLEND(1)););"</case>
                        <default />
                    </switch>
                    />                    
                    <elseif condition="$roam['spot_type'] eq 3"/>
                    <hotspot style="skin_hotspotstyle" title="{$roam['title']}" devices="{$device[$roam['is_flash']][$roam['is_html5']]}" name="spot{$roam.id}" type="image" url="%SWFPATH%/spot/{$roam.spoturl||basename=###}"
                         keep="false" visible="true" enabled="true" handcursor="true" zorder="2"
                         ath="{$roam.spot_x}" atv="{$roam.spot_y}" distorted="true" rx="{$roam.rx}" ry="{$roam.ry}" rz="{$roam.rz}"
                         edge="center" scale="{$roam['spot_scale']/100}" rotate="0" alpha="1.0"
						 <eq name="roam['is_showtext']" value="1">onloaded="showtxt_action();"</eq>
                    <switch name="roam.changetype" >
                        <case value="1">onclick="ifnot(device.html5,moveto({$roam['spot_x']},{$roam['spot_y']},smooth());loadscene(scene{$scenedata[$roam['target_id']]}, view.vlookat={$roam['target_y']}&amp;view.hlookat={$roam['target_x']}, MERGE,ZOOMBLEND(1,3));,loadscene(scene{$scenedata[$roam['target_id']]}, view.hlookat={$roam['target_x']}, MERGE,ZOOMBLEND(1,3)););"</case>
                        <case value="2">onclick="ifnot(device.html5,moveto({$roam['spot_x']},{$roam['spot_y']},smooth());loadscene(scene{$scenedata[$roam['target_id']]}, view.vlookat={$roam['target_y']}&amp;view.hlookat={$roam['target_x']}, MERGE,BLEND(1));,loadscene(scene{$scenedata[$roam['target_id']]}, view.hlookat={$roam['target_x']}, MERGE,BLEND(1)););"</case>
                        <case value="3">onclick="ifnot(device.html5,loadscene(scene{$scenedata[$roam['target_id']]}, view.vlookat={$roam['target_y']}&amp;view.hlookat={$roam['target_x']}, MERGE,BLEND(1));,loadscene(scene{$scenedata[$roam['target_id']]}, view.hlookat={$roam['target_x']}, MERGE,BLEND(1)););"</case>
                        <default />
                    </switch>
                    />
                </if>
            </volist>

            <volist name="view['link']" id="link">
                <if condition="$link['spot_type'] eq 1">
                    <hotspot devices="{$device[$link['is_flash']][$link['is_html5']]}" title="{$link['title']}" name="lkspot{$link.id}" alpha="1" ath="{$link.spot_x}" scale="{$link['spot_scale']/100}"
                    atv="{$link.spot_y}" url="%SWFPATH%/spot/{$spotdata[$link['spot_id']]['file']||basename=###}"
                    align="{$link.spot_edge}" edge="{$link.spot_edge}"
					<if condition="$link['opentype'] eq	1">onclick="openIframe(820,540,'{$link.tuwenlink}')"</if>
					<if condition="$link['opentype'] eq	2">onclick="openLink('{$link.linkurl}')"</if>
                    <if condition="$link['is_hover'] eq 1">onloaded="showtxt_action();"</if>
                    />
                    <elseif condition="$link['spot_type'] eq 2"/>
                    <hotspot devices="{$device[$link['is_flash']][$link['is_html5']]}" title="{$link['title']}" name="lkspot{$link.id}" alpha="1" ath="{$link.spot_x}" scale="{$link['spot_scale']/100}" atv="{$link.spot_y}" url="%SWFPATH%/spot/{$spotdata[$link['spot_id']]['file']||basename=###}"
                    align="{$link.spot_edge}" edge="{$link.spot_edge}" 
                    <if condition="$link['opentype'] eq	1">onclick="openIframe(820,540,'{$link.tuwenlink}')"</if>
					<if condition="$link['opentype'] eq	2">onclick="openLink('{$link.linkurl}')"</if>
                    <if condition="$link['is_hover'] eq 1">
					onloaded="do_crop_animation({$spotdata[$link['spot_id']]['width']},{$spotdata[$link['spot_id']]['height']},60);showtxt_action();"
					<else/>
					onloaded="do_crop_animation({$spotdata[$link['spot_id']]['width']},{$spotdata[$link['spot_id']]['height']},60);"
					</if>
                    />
                    <elseif condition="$link['spot_type'] eq 3"/>
                    <hotspot devices="{$device[$link['is_flash']][$link['is_html5']]}" title="{$link['title']}" name="lkspot{$link.id}" type="image" url="%SWFPATH%/spot/{$link.spoturl||basename=###}"
                         keep="false" visible="true" enabled="true" handcursor="true"
                         ath="{$link.spot_x}" atv="{$link.spot_y}" distorted="true" rx="{$link.rx}" ry="{$link.ry}" rz="{$link.rz}"
                         edge="center" scale="{$link['spot_scale']/100}" rotate="0" alpha="1.0"
						 <if condition="$link['opentype'] eq 1">onclick="openIframe(820,540,'{$link.tuwenlink}')"</if>
						 <if condition="$link['opentype'] eq 2">onclick="openLink('{$link.linkurl}')"</if>
                         <if condition="$link['is_hover'] eq 1">onloaded="showtxt_action();"</if>
                    />
                </if>
            </volist>
			<!-- shipinredian -->
            <volist name="view['vpoint']" id="vpoint">
                <if condition="$vpoint['spot_type'] eq 1">
                    <hotspot devices="{$device[$vpoint['is_flash']][$vpoint['is_html5']]}" title="{$vpoint['title']}" name="vpspot{$vpoint.id}" alpha="1" ath="{$vpoint.spot_x}" scale="{$vpoint['spot_scale']/100}"
                    atv="{$vpoint.spot_y}" url="%SWFPATH%/spot/{$spotdata[$vpoint['spot_id']]['file']||basename=###}"
                    align="{$vpoint.spot_edge}" edge="{$vpoint.spot_edge}" 
					onclick="videoplayer_open('{$vpoint.url}', '{$vpoint.appleimg}', 0.5);"
                    <if condition="$vpoint['is_hover'] eq 1">onloaded="showtxt_action();"</if>
                    />
                <elseif condition="$vpoint['spot_type'] eq 2"/>
                    <hotspot devices="{$device[$vpoint['is_flash']][$vpoint['is_html5']]}" title="{$vpoint['title']}" name="vpspot{$vpoint.id}" alpha="1" ath="{$vpoint.spot_x}" scale="{$vpoint['spot_scale']/100}" atv="{$vpoint.spot_y}" url="%SWFPATH%/spot/{$spotdata[$vpoint['spot_id']]['file']||basename=###}"
                    align="{$vpoint.spot_edge}" edge="{$vpoint.spot_edge}" 
                    onclick="videoplayer_open('{$vpoint.url}', '{$vpoint.appleimg}', 0.5);"
                    <if condition="$vpoint['is_hover'] eq 1">
					onloaded="do_crop_animation({$spotdata[$vpoint['spot_id']]['width']},{$spotdata[$vpoint['spot_id']]['height']},60);showtxt_action();"
					<else/>
					onloaded="do_crop_animation({$spotdata[$vpoint['spot_id']]['width']},{$spotdata[$vpoint['spot_id']]['height']},60);"
					</if>
                    />
                <elseif condition="$vpoint['spot_type'] eq 3"/>
                    <hotspot devices="{$device[$vpoint['is_flash']][$vpoint['is_html5']]}" title="{$vpoint['title']}" name="vpspot{$vpoint.id}" type="image" url="%SWFPATH%/spot/{$vpoint.spoturl||basename=###}"
						 keep="false" visible="true" enabled="true" handcursor="true"
                         ath="{$vpoint.spot_x}" atv="{$vpoint.spot_y}" distorted="true" rx="{$vpoint.rx}" ry="{$vpoint.ry}" rz="{$vpoint.rz}"
                         edge="center" scale="{$vpoint['spot_scale']/100}" rotate="0" alpha="1.0" 
						 onclick="videoplayer_open('{$vpoint.url}', '{$vpoint.appleimg}', 0.5);"
                         <if condition="$vpoint['is_hover'] eq 1">onloaded="showtxt_action();"</if>
                    />
                </if>
            </volist>				
			<!-- shipinredian for mobile -->
			<if condition="!empty($view['vpoint'])">
			<krpano devices="mobile">
				<volist name="view['vpoint']" id="vpoint">
					<hotspot name="vpspot{$vpoint.id}"
					scale="1.0"
					zoom="true"
					ath="{$vpoint.spot_x}" atv="{$vpoint.spot_y}"
					onclick="videoplayer_open('{$vpoint.url}', '{$vpoint.appleimg}', 0.5);"
					/>
				</volist>
			</krpano>
			</if>



            <volist name="view['zhu']" id="zhu">
				<if condition="$zhu['spot_type'] eq 1">
                    <hotspot devices="{$device[$zhu['is_flash']][$zhu['is_html5']]}" title="{$zhu['title']}" name="zhuspot{$zhu.id}" alpha="1" ath="{$zhu.spot_x}" scale="{$zhu['spot_scale']/100}"
                        atv="{$zhu.spot_y}" url="%SWFPATH%/spot/{$spotdata[$zhu['spot_id']]['file']||basename=###}"
                        align="{$zhu.spot_edge}" edge="{$zhu.spot_edge}" zorder="4" style="tooltip" tooltip="{$zhu['title']}"
						onclick="openIframe(820,540,'{$zhu.tuwenlink}')" />

                    <elseif condition="$zhu['spot_type'] eq 2"/>
                    <hotspot devices="{$device[$zhu['is_flash']][$zhu['is_html5']]}" title="{$zhu['title']}" name="zhuspot{$zhu.id}" alpha="1" ath="{$zhu.spot_x}" scale="{$zhu['spot_scale']/100}" atv="{$zhu.spot_y}" url="%SWFPATH%/spot/{$spotdata[$zhu['spot_id']]['file']||basename=###}"
                        align="{$zhu.spot_edge}" edge="{$zhu.spot_edge}" zorder="4" style="tooltip" tooltip="{$zhu['title']}" onclick="openIframe(820,540,'{$zhu.tuwenlink}')" onloaded="do_crop_animation({$spotdata[$zhu['spot_id']]['width']},{$spotdata[$zhu['spot_id']]['height']},60)" />

					<elseif condition="$zhu['spot_type'] eq 3"/>
                    <hotspot devices="{$device[$zhu['is_flash']][$zhu['is_html5']]}" title="{$zhu['title']}" name="zhuspot{$zhu.id}" type="image" url="%SWFPATH%/spot/{$zhu.spoturl||basename=###}"
                         keep="false" visible="true" enabled="true" handcursor="true"
                         ath="{$zhu.spot_x}" atv="{$zhu.spot_y}" distorted="true" rx="{$zhu.rx}" ry="{$zhu.ry}" rz="{$zhu.rz}"
                         edge="center" scale="{$zhu['spot_scale']/100}" rotate="0" alpha="1.0" zorder="4" style="tooltip" tooltip="{$zhu['title']}"
						 onclick="openIframe(820,540,'{$zhu.tuwenlink}')" />
				</if>
            </volist>

            <volist name="view['cube']" id="cube">
                <if condition="$cube['spot_type'] eq 1">
                    <hotspot devices="{$device[$cube['is_flash']][$cube['is_html5']]}" title="{$cube['title']}" name="cubespot{$cube.id}" alpha="1" ath="{$cube.spot_x}" scale="{$cube['spot_scale']/100}"
                    atv="{$cube.spot_y}" url="%SWFPATH%/spot/{$spotdata[$cube['spot_id']]['file']||basename=###}"
                    align="{$cube.spot_edge}" edge="{$cube.spot_edge}"
                    <if condition="$cube['is_hover'] eq 1">onloaded="showtxt_action();"</if>
                    onclick="set(layer[cube{$cube.id}].visible,true);set(skin_settings.cube{$cube.id}_open,1);cube{$cube.id}next();"
                    />
                    <elseif condition="$cube['spot_type'] eq 2"/>
                    <hotspot devices="{$device[$cube['is_flash']][$cube['is_html5']]}" title="{$cube['title']}" name="cubespot{$cube.id}" alpha="1" ath="{$cube.spot_x}" scale="{$cube['spot_scale']/100}" atv="{$cube.spot_y}" url="%SWFPATH%/spot/{$spotdata[$cube['spot_id']]['file']||basename=###}"
                    align="{$cube.spot_edge}" edge="{$cube.spot_edge}" 
                    <if condition="$cube['is_hover'] eq 1">
					onloaded="do_crop_animation({$spotdata[$cube['spot_id']]['width']},{$spotdata[$cube['spot_id']]['height']},60);showtxt_action();"
					<else/>
					onloaded="do_crop_animation({$spotdata[$cube['spot_id']]['width']},{$spotdata[$cube['spot_id']]['height']},60);"
					</if>
                    onclick="set(layer[cube{$cube.id}].visible,true);set(skin_settings.cube{$cube.id}_open,1);cube{$cube.id}next();"
                    />

                    <elseif condition="$cube['spot_type'] eq 3"/>
                    <hotspot devices="{$device[$cube['is_flash']][$cube['is_html5']]}" title="{$cube['title']}" name="cubespot{$cube.id}" type="image" url="%SWFPATH%/spot/{$cube.spoturl||basename=###}"
		     keep="false" visible="true" enabled="true" handcursor="true" ath="{$cube.spot_x}" atv="{$cube.spot_y}" distorted="true" rx="{$cube.rx}" ry="{$cube.ry}" rz="{$cube.rz}" edge="center" scale="{$cube['spot_scale']/100}" rotate="0" alpha="1.0"
                    <if condition="$cube['is_hover'] eq 1">onloaded="showtxt_action();"</if>
                    onclick="set(layer[cube{$cube.id}].visible,true);set(skin_settings.cube{$cube.id}_open,1);cube{$cube.id}next();"
                    />
                </if>
            </volist>

            <volist name="view['cubebag']" id="cubebag">
                <php>echo "<include";</php> url="%SWFPATH%/cube/cube{$cubebag}/cube.xml" />
            </volist>


            <volist name="view['photo']" id="photo">
                <if condition="$photo['spot_type'] eq 1">
                    <hotspot devices="{$device[$photo['is_flash']][$cube['is_html5']]}" title="{$photo['title']}" name="photospot{$photo.id}" alpha="1" ath="{$photo.spot_x}" scale="{$photo['spot_scale']/100}"
                    atv="{$photo.spot_y}" url="%SWFPATH%/spot/{$spotdata[$photo['spot_id']]['file']||basename=###}"
                    align="{$photo.spot_edge}" edge="{$photo.spot_edge}"
                    <if condition="$photo['is_hover'] eq 1">onloaded="showtxt_action();"</if>
                    onclick="set(layer[photo{$photo.id}].visible,true);"
                    />
                    <elseif condition="$photo['spot_type'] eq 2"/>
                    <hotspot devices="{$device[$photo['is_flash']][$photo['is_html5']]}" title="{$photo['title']}" name="photospot{$photo.id}" alpha="1" ath="{$photo.spot_x}" scale="{$photo['spot_scale']/100}" atv="{$photo.spot_y}" url="%SWFPATH%/spot/{$spotdata[$photo['spot_id']]['file']||basename=###}"
                    align="{$photo.spot_edge}" edge="{$photo.spot_edge}" 
					<if condition="$photo['is_hover'] eq 1">
					onloaded="do_crop_animation({$spotdata[$photo['spot_id']]['width']},{$spotdata[$photo['spot_id']]['height']},60);showtxt_action();"
					<else/>
					onloaded="do_crop_animation({$spotdata[$photo['spot_id']]['width']},{$spotdata[$photo['spot_id']]['height']},60);"
					</if>
                    onclick="set(layer[photo{$photo.id}].visible,true);"
                    />
                    <elseif condition="$photo['spot_type'] eq 3"/>
                    <hotspot devices="{$device[$photo['is_flash']][$photo['is_html5']]}" title="{$photo['title']}" name="photospot{$photo.id}" type="image" url="%SWFPATH%/spot/{$photo.spoturl||basename=###}"
                         keep="false" visible="true" enabled="true" handcursor="true"
                         ath="{$photo.spot_x}" atv="{$photo.spot_y}" distorted="true" rx="{$photo.rx}" ry="{$photo.ry}" rz="{$photo.rz}"
                         edge="center" scale="{$photo['spot_scale']/100}" rotate="0" alpha="1.0"
                         <if condition="$photo['is_hover'] eq 1">onloaded="showtxt_action();"</if>
                         onclick="set(layer[photo{$photo.id}].visible,true);"
                    />
                </if>
            </volist>

            <volist name="view['hotploy']" id="hotploy">
                <hotspot name="ploypot{$hotploy.id}" keep="false" visible="true" enabled="true"
                    fillcolor="{$hotploy['fillcolor']|str_replace='#','0x',###}" fillcolorhover="{$hotploy['fillcolorhover']|str_replace='#','0x',###}"
                    fillalpha="{$hotploy['fillalpha']}" fillalphahover="{$hotploy['fillalphahover']}"
                    borderwidth="{$hotploy['borderwidth']}" borderwidthhover="{$hotploy['borderwidthhover']}" bordercolor="{$hotploy['bordercolor']|str_replace='#','0x',###}" bordercolorhover="{$hotploy['bordercolorhover']|str_replace='#','0x',###}"
                    borderalpha="{$hotploy['borderalpha']}" borderalphahover="{$hotploy['borderalphahover']}"
					<if condition="$hotploy['action_type'] eq 1">
					onclick="loadscene({:getScene($hotploy['scene_id'])}, Null, MERGE,BLEND(1));"
					<elseif condition="$hotploy['action_type'] eq 3"/>
					onclick="openIframe({$hotploy.textbox_width},{$hotploy.textbox_height},'{$hotploy.tuwenlink}')"
					<else />
					onclick="set(layer[ploycube{$hotploy.id}].visible,true);"
					</if>
                >
                    <volist name="hotploy['pointarr']" id="spot">
                        <point ath="{$spot.ath}" atv="{$spot.atv}"/>
                    </volist>
                </hotspot>
            </volist>

			<!-- requtanshipin -->
            <volist name="view['ployvideo']" id="ployvideo">
                <hotspot name="ployvideo{$ployvideo.id}" keep="false" visible="true" enabled="true"
                    fillcolor="{$ployvideo['fillcolor']|str_replace='#','0x',###}" fillcolorhover="{$ployvideo['fillcolorhover']|str_replace='#','0x',###}"
                    fillalpha="{$ployvideo['fillalpha']}" fillalphahover="{$ployvideo['fillalphahover']}"
                    borderwidth="{$ployvideo['borderwidth']}" borderwidthhover="{$ployvideo['borderwidthhover']}" bordercolor="{$ployvideo['bordercolor']|str_replace='#','0x',###}" bordercolorhover="{$ployvideo['bordercolorhover']|str_replace='#','0x',###}"
                    borderalpha="{$ployvideo['borderalpha']}" borderalphahover="{$ployvideo['borderalphahover']}"
					onclick="videoplayer_open('{$ployvideo.url}', '{$ployvideo.appleimg}', 0.5);"
                >
                    <volist name="ployvideo['pointarr']" id="spot">
                        <point ath="{$spot.ath}" atv="{$spot.atv}"/>
                    </volist>
                </hotspot>
            </volist>
			<if condition="!empty($view['ployvideo'])">
			<krpano devices="mobile">
				<volist name="view['ployvideo']" id="ployvideo">
					<hotspot name="ployvideo{$ployvideo.id}" zoom="true"
					onclick="videoplayer_open('{$ployvideo.url}', '{$ployvideo.appleimg}', 0.5);"
					/>
				</volist>
			</krpano>
			</if>



			<!-- shipinrequ -->
            <volist name="view['vspot']" id="vspot">
                <hotspot name="videospot{$vspot.id}"
                     url="%SWFPATH%/plugins/videoplayer.swf"
                     alturl="%SWFPATH%/plugins/videoplayer.js"
                     videourl="{$vspot.url}"
                     posterurl="{$vspot.appleimg}"
                     distorted="true" devices="{$vspot.devices}"
                     ath="{$vspot.ath}" atv="{$vspot.atv}"
                     edge="center"
                     scale="{$vspot.scale}" rx="{$vspot.rx}" ry="{$vspot.ry}" rz="{$vspot.rz}"
                     loop="true"
                     pausedonstart="true"
                     directionalsound="true"
                     range="200"
                     volume="0.7"
                     onhover="{$vspot.hover}"
                     style="{$vspot.style}"
                     onclick="{$vspot.eve}"
                     />
            </volist>
			<if condition="!empty($view['vspot'])">
			<krpano devices="mobile">
				<volist name="view['vspot']" id="vspot">
					<hotspot name="videospot{$vspot.id}" visible="false" />
					<hotspot name="videospot_mobile_{$vspot.id}"
					url="%SWFPATH%/images/media_playback_start.png"
					scale="0.5"
					zoom="true"
					ath="{$vspot.ath}" atv="{$vspot.atv}"
					onclick="videoplayer_open('{$vspot.url}', '{$vspot.appleimg}', 0.5);"
					/>
				</volist>
			</krpano>
			</if>
			

            <volist name="view['photobag']" id="photobag">
                <php>echo "<include";</php> url="%SWFPATH%/photo/photo{$photobag}/photo.xml?<php>echo time();</php>" />
            </volist>

            <volist name="view['hotploybag']" id="hotploybag">
                <php>echo "<include";</php> url="%SWFPATH%/toolbox/ployimg/ployxml{$hotploybag}.xml?<php>echo time();</php>" />
            </volist>

            <volist name="view['lensflare']" id="lensflare">
                <lensflare name="lens{$lensflare.id}" ath="{$lensflare.ath}" atv="{$lensflare.atv}"  alpha="1" set="DEFAULT" size="{$lensflare['size']/100}" blind="{$lensflare['blind']/100}" blindcurve="{$lensflare.blindcurve}" keep="False" />
            </volist>

            <eq name="view['haveui']" value="1">
                <php>echo "<include";</php> url="%SWFPATH%/scene/scene{$view.sort}/ui/ui.xml?<php>echo time();</php>" />
            </eq>
			
            <action name="newsceneevent">
                <if condition='$weather_used gt 0'>action({$view['effect_mod']});</if>
                <if condition="$view['sort'] eq $firstscene['sort'] and $panorow['is_littleplanet_view'] eq 1">
				<php>$scene_key = $firstscene['sort']-1;</php>
					if(scene[{$scene_key}].firsttime,
                        becomestar();
                        set(scene[{$scene_key}].firsttime,false);
                    delayedcall({$view['star_time']}, normalview({$view['hlookat']},{$view['vlookat']},{$view['fov']})));
                </if>
                <eq name="toolboxmap_on" value="1">toolboxmapto({$view['sort']});</eq>
                <eq name="toolboxmaps_on" value="1">toolboxmapsto({$view['sort']});</eq>
            </action>

            <eq name="view['luopan']['open']" value="1">
                <plugin name="luoban{$view['luopan']['view_id']}" keep="false" width="130" height="130" scale="1" zorder="0" align="center" edge="center" url="%SWFPATH%/toolbox/luopan/{$view['luopan']['image']|basename=###}" alpha="1"  handcursor="true" enabled="true" parent="luopanbox" />
                <events onviewchange= "set(plugin[luopanbox].visible,true);set(plugin[luopan_bang].visible,true);div(luopandu,get(view.hlookat),-1);sub(plugin[luoban{view['luopan']['view_id']}].rotate,-180, get(luopandu));"/>
            </eq>
            <eq name="view['luopan']['open']" value="0">
                <events onviewchange= "set(plugin[luopanbox].visible,false);set(plugin[luopan_bang].visible,false);"/>
            </eq>

        </scene>
    </volist>

    <plugin name="luopanbox" url="%SWFPATH%/toolbox/luopan/none.png" keep="true" zorder="1" children="false" align="righttop" edge="center" x="80" y="80" scale="1" scalechildren="true" destscale="1.0" alpha="1" visible="true" capture="true" handcursor="true" enabled="true"/>
    <plugin name="luopan" url="%SWFPATH%/toolbox/luopan/kedu.png" keep="true" handcursor="false" parent="luopanbox" zorder="1" alpha="1"  y="0" align="center" mask="plugin[luopan_mask]" visible="true" enabled="false"/>
    <plugin name="luopan_mask" url="%SWFPATH%/toolbox/luopan/luopan_mask.png" keep="true" zorder="4" parent="luopanbox" align="center" blendmode="normal" visible="false" capture="false" handcursor="true" enabled="false" />
    <plugin name="luopan_quan" url="%SWFPATH%/toolbox/luopan/quan.png" alpha="1" keep="true" enabled="false" visible="true" parent="luopanbox" zorder="4" align="center" capture="false" handcursor="false"/>
    <plugin name="luopan_hover" url="%SWFPATH%/toolbox/luopan/hover.png" keep="true" enabled="false" visible="true" parent="luopanbox" zorder="3" align="center" capture="false" handcursor="false" mask="plugin[luopan_mask]"/>
    <plugin name="luopan_v" url="%SWFPATH%/toolbox/luopan/luopanv.png" keep="true" enabled="false" visible="true" parent="luopanbox" zorder="2" align="top" capture="false" handcursor="false" y="-37" />

    <plugin name="luopan_bang" url="%SWFPATH%/toolbox/luopan/none.png" keep="true" zorder="8" align="righttop" edge="center" width="100" height="100" x="80" y="80" handcursor="false" alpha="1" />
    <plugin name="luopan_bangdou" url="%SWFPATH%/toolbox/luopan/bang.png" keep="true" zorder="2" align="center" parent="luopan_bang"  x="0" y="0" ondown="startluopanslider();" onup="stopluopanslider();"/>
    <krpano devices="mobile">				
	<plugin name="luopanbox" scale="0.5" altscale="0.5" />
	</krpano>

	<action name="startluopanslider">
    set(plugin[luopan_bangdou].backup_align, get(plugin[luopan_bangdou].align));
    set(plugin[luopan_bangdou].backup_edge,  get(plugin[luopan_bangdou].edge));
    plugin[luopan_bangdou].changeorigin(center,center);
    sub(mouse_x_offset, plugin[luopan_bangdou].x, mouse.x);
    sub(mouse_y_offset, plugin[luopan_bangdou].y, mouse.y);
    set(image_dragging,true);
    luopanslider();r\n";
    </action>

    <action name="stopluopanslider">
    set(image_dragging, false);
    set(plugin[luopan_bangdou].x, 0);
    set(plugin[luopan_bangdou].y, 0);
    </action>

    <action name="luopanslider">
    if(image_dragging,
    add(ypos, mouse.y, mouse_y_offset);
    add(xpos, mouse.x, mouse_x_offset);
    if(ypos LT -35, set(ypos,-35));
    if(ypos GT 35, set(ypos,35));
    if(xpos LT -35, set(xpos,-35));
    if(xpos GT 35, set(xpos,35));
    copy(plugin[luopan_bangdou].y, ypos);
    copy(plugin[luopan_bangdou].x, xpos);
    setblend(get(val));
    div(ypos , ypos , 40);
    div(xpos , xpos , 15);
    add(valx, xpos , 0);
    add(valy, ypos , 0);
    add(view.vlookat , valy , get(view.vlookat) );
    add(view.hlookat , valx , get(view.hlookat) );
    delayedcall(0.01, luopanslider() );
    ,
    plugin[luopan_bangdou].changeorigin(get(plugin[luopan_bangdou].backup_align), get(plugin[luopan_bangdou].backup_edge));
    );
    </action>
</krpano>